PROMPT_PARSE_REQUEST = """Ты получаешь запрос от клиента по модификации программного проекта. Твоя задача извлечь из запроса структурированную информацию

Запрос клиента:
{client_request}

Контекст проекта (если доступен):
{project_digest}

Извлеки следующую информацию:

1. GOAL: одно предложение, описывающее главную цель запроса
2. ACTIONS: список конкретных действий которые клиент хочет выполнить. Каждое действие должно быть проверяемым
3. CONSTRAINTS: ограничения которые клиент указал явно (технологические, временные, платформенные)
4. IMPLICIT_REQUIREMENTS: требования которые не указаны явно но вытекают из контекста запроса и проекта
5. PRIORITY: high/medium/low на основе тона и срочности запроса
6. SCOPE: четкие границы задачи, что входит и что не входит

Если запрос слишком размытый чтобы определить ACTIONS или SCOPE, верни поле CLARIFICATION_NEEDED со списком конкретных вопросов которые нужно задать клиенту

Формат ответа строго JSON"""

PROMPT_PROJECT_DIGEST = """Ты анализируешь кодовую базу программного проекта в контексте конкретного запроса на модификацию

Структура файлов проекта:
{file_tree}

Содержимое ключевых файлов:
{file_contents}

Запрос на модификацию:
{parsed_request}

Создай вытяжку проекта (Project Digest) которая содержит:

1. PROJECT_NAME: название проекта из конфигурации или корневой директории
2. STACK: язык, фреймворки, инфраструктура, базы данных
3. STRUCTURE: точки входа, конфигурационные файлы, ключевые модули с кратким описанием назначения каждого
4. DEPENDENCIES: внешние зависимости проекта с версиями если указаны
5. ARCHITECTURE_NOTES: краткое описание архитектурного подхода
6. RELEVANT_FILES: файлы которые будут затронуты или релевантны запросу клиента. Для каждого файла укажи путь и краткое описание почему он релевантен
7. POTENTIAL_ISSUES: проблемы которые могут возникнуть при выполнении запроса

Фокусируйся на том что релевантно запросу клиента

Формат ответа строго JSON"""

PROMPT_CHECKLIST = """На основе вытяжки проекта и запроса клиента создай чеклист задач для модификации проекта

Вытяжка проекта:
{project_digest}

Запрос клиента:
{parsed_request}

Правила создания чеклиста:

1. Каждая задача должна быть атомарной
2. Каждая задача должна иметь проверяемый критерий приемки
3. Задачи сгруппированы по категориям: ANALYSIS, MODIFICATION, CREATION, DELETION, CONFIGURATION, VERIFICATION
4. Внутри каждой категории задачи упорядочены по зависимостям
5. Если задача зависит от другой задачи, это указано явно
6. Категория ANALYSIS идет первой, VERIFICATION последней

Для каждой задачи укажи:
- id: уникальный идентификатор (формат CAT-NNN, например MOD-001)
- category: категория из списка выше
- title: краткое название
- description: описание что конкретно нужно сделать
- affected_files: список файлов которые затрагивает задача
- depends_on: список id задач от которых зависит эта задача
- acceptance_criteria: как проверить что задача выполнена

Формат ответа строго JSON"""

PROMPT_WALKTHROUGH = """На основе вытяжки проекта, запроса клиента и чеклиста задач создай Walkthrough документ

Вытяжка проекта:
{project_digest}

Запрос клиента:
{parsed_request}

Чеклист задач:
{checklist}

Правила создания walkthrough:

1. Документ группируется по функциональным блокам, а не по файлам
2. Для каждого функционального блока укажи:
   - Название блока
   - Цель: зачем эти изменения нужны
   - Затрагиваемые файлы с указанием типа операции (новый, изменен, удален)
   - Описание изменений: что именно меняется и почему
   - Связь с чеклистом: id задач из чеклиста которые покрывает этот блок
   - Риски: что может пойти не так
3. В конце документа добавь секцию верификации
4. Каждая задача из чеклиста должна быть покрыта хотя бы одним блоком

Формат ответа строго JSON"""

PROMPT_IMPLEMENTATION_PLAN = """На основе собранной информации создай детальный план имплементации

Вытяжка проекта:
{project_digest}

Запрос клиента:
{parsed_request}

Чеклист задач:
{checklist}

Walkthrough:
{walkthrough}

Правила создания плана:

1. План состоит из пронумерованных шагов. Каждый шаг это одно конкретное действие
2. Для каждого шага укажи:
   - step_number: порядковый номер
   - checklist_id: id задачи из чеклиста
   - action_type: тип действия (create_file, modify_file, delete_file, run_command, verify)
   - target: путь к файлу или команда
   - description: описание что нужно сделать на уровне бизнес-логики
   - details: для modify_file какие секции затрагиваются. Для create_file описание структуры. Для run_command полная команда
   - rollback: как откатить это действие
3. Шаги упорядочены так чтобы проект оставался работоспособным после каждого шага
4. После каждого логического блока добавь шаг верификации
5. В начале плана добавь секцию prerequisites
6. В конце плана добавь секцию review_required

Формат ответа строго JSON"""

PROMPT_REVIEW_COMMENTS = """Клиент оставил комментарии к сгенерированным документам планирования. Проанализируй комментарии и определи какие изменения нужно внести

Комментарии клиента:
{client_comments}

Текущий чеклист:
{checklist}

Текущий walkthrough:
{walkthrough}

Текущий план имплементации:
{implementation_plan}

Для каждого комментария определи:

1. comment_type: тип комментария
   - "approve" клиент одобряет без замечаний
   - "minor_edit" мелкая правка, не меняет scope
   - "major_change" существенное изменение, меняет scope или подход
   - "rejection" клиент хочет отклонить и начать заново

2. affected_documents: какие документы затронуты (checklist, walkthrough, implementation_plan)
3. changes: конкретные изменения которые нужно внести
4. regeneration_needed: нужна ли полная перегенерация документа

Если комментарии противоречат друг другу, отметь это в поле conflicts

Формат ответа строго JSON"""

PROMPT_EXECUTE_STEP = """Выполни один шаг из плана имплементации

Шаг для выполнения:
{step}

Контекст проекта:
{project_digest}

Текущее содержимое целевого файла (если применимо):
{current_file_content}

Лог предыдущих шагов:
{previous_steps_log}

Правила выполнения:

1. Если action_type = create_file, верни полное содержимое нового файла
2. Если action_type = modify_file, верни только измененные секции с достаточным контекстом для точного определения места вставки
3. Если action_type = delete_file, подтверди удаление и укажи нужно ли обновить импорты в других файлах
4. Если action_type = run_command, верни команду и ожидаемый результат
5. Если action_type = verify, верни описание проверки и команды для её выполнения

Не меняй ничего что не описано в шаге. Минимальные изменения

Формат ответа строго JSON"""
